<?xml version="1.0" encoding="UTF-8" ?>  
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.wwh.dao.IWalletAmountDao">


<insert id="insert" parameterType="com.wwh.vo.WalletAmountVO" >
    <selectKey resultType="java.lang.Long" keyProperty="id" order="AFTER" >
      SELECT LAST_INSERT_ID()
    </selectKey>
    insert into wallet_amount_t (user_id, total_score, recharge_amount, 
      platform_total_amount, used_score, remain_score, 
      active_flag, delete_flag, created_date, 
      created_by, last_updated_date, last_updated_by
      )
    values (
    #{userId,jdbcType=BIGINT}, 
    #{totalScore,jdbcType=DECIMAL}, 
    #{rechargeAmount,jdbcType=DECIMAL}, 
      #{platformTotalAmount,jdbcType=DECIMAL}, 
      #{usedScore,jdbcType=DECIMAL}, 
      #{remainScore,jdbcType=DECIMAL}, 
      #{activeFlag,jdbcType=CHAR}, 
      #{deleteFlag,jdbcType=CHAR}, 
      now(), 
      #{createdBy,jdbcType=BIGINT}, 
      now(), 
      #{lastUpdatedBy,jdbcType=BIGINT}
      )
  </insert>
  
<insert id="insertBatch" parameterType="java.util.List" >
    insert into wallet_amount_t (user_id, 
      total_score, recharge_amount, 
      platform_total_amount, used_score, 
      remain_score, active_flag, delete_flag, 
      created_date, created_by, last_updated_date, 
      last_updated_by)
    values <foreach item="item" index="index" collection="records"  separator="," > (
    #{item.userId,jdbcType=BIGINT}, 
      #{item.totalScore,jdbcType=DECIMAL}, 
      #{item.rechargeAmount,jdbcType=DECIMAL}, 
      #{item.platformTotalAmount,jdbcType=DECIMAL}, 
      #{item.usedScore,jdbcType=DECIMAL}, 
      #{item.remainScore,jdbcType=DECIMAL}, 
      #{item.activeFlag,jdbcType=CHAR}, 
      #{item.deleteFlag,jdbcType=CHAR}, 
      now(), 
      #{item.createdBy,jdbcType=BIGINT}, 
      now(), 
      #{item.lastUpdatedBy,jdbcType=BIGINT}
      )</foreach>
  </insert>
	 
	  
	  <sql id="Base_Column_List" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Oct 24 11:16:28 CST 2016.
    -->
    id, 
    user_id as userId, 
    total_score as totalScore, 
    recharge_amount as rechargeAmount, 
    platform_total_amount as platformTotalAmount, 
    used_score as usedScore, 
    remain_score as remainScore, 
    active_flag as activeFlag, 
    delete_flag as deleteFlag, 
    created_date as createdDate, 
    created_by as createdBy, 
    last_updated_date as lastUpdatedDate, 
    last_updated_by as lastUpdatedBy
  </sql>
  
	  <select id="getByUserId" resultType="com.wwh.vo.WalletAmountVO" parameterType="java.lang.Long" >
	    <!--
	      WARNING - @mbggenerated
	      This element is automatically generated by MyBatis Generator, do not modify.
	      This element was generated on Mon Oct 24 16:31:40 CST 2016.
	    -->
	    select 
	    <include refid="Base_Column_List" />
	    from wallet_amount_t
	    where user_id = #{id,jdbcType=BIGINT}
	  </select>
	  

	<select id="selectByPrimaryKey" resultType="com.wwh.vo.WalletAmountVO" parameterType="java.lang.Long" >
	    <!--
	      WARNING - @mbggenerated
	      This element is automatically generated by MyBatis Generator, do not modify.
	      This element was generated on Mon Oct 24 16:31:40 CST 2016.
	    -->
	    select 
	    <include refid="Base_Column_List" />
	    from wallet_amount_t
	    where id = #{id,jdbcType=BIGINT}
	  </select>
  
	<!-- 修改用户钱包  userId 不允许为空 -->
	<insert id="updateByUserIdSelective" parameterType="com.wwh.vo.WalletAmountVO">
		INSERT INTO wallet_amount_t (
			user_id,
			total_score,
			recharge_amount,
			platform_total_amount,
			used_score,
			remain_score,
			active_flag,
			delete_flag,
			created_date,
			created_by,
			last_updated_date,
			last_updated_by
		)
		VALUES
			(
				#{userId},
				#{totalScore},
				#{rechargeAmount},
				#{platformTotalAmount},
				#{usedScore},
				#{remainScore},
				'Y',
				'N',
				NOW(),
				#{createdBy},
				NOW(),
				#{lastUpdatedBy}
			) ON DUPLICATE KEY UPDATE 
			total_score = total_score + #{totalScore},
			recharge_amount = recharge_amount + #{rechargeAmount},
			platform_total_amount = platform_total_amount + #{platformTotalAmount},
			used_score = used_score + #{usedScore},
			remain_score = remain_score + #{remainScore},
			last_updated_date = NOW(),
			last_updated_by = #{lastUpdatedBy}
	</insert>

	<!-- 修改用户钱包  userId 不允许为空 -->
	<update id="updateByPrimaryKeySelective" parameterType="com.wwh.vo.WalletAmountVO" >
    update wallet_amount_t
    <set >
      <if test="userId != null" >
        user_id = #{userId,jdbcType=BIGINT},
      </if>
      <if test="totalScore != null" >
        total_score = #{totalScore,jdbcType=DECIMAL},
      </if>
      <if test="rechargeAmount != null" >
        recharge_amount = #{rechargeAmount,jdbcType=DECIMAL},
      </if>
      <if test="platformTotalAmount != null" >
        platform_total_amount = #{platformTotalAmount,jdbcType=DECIMAL},
      </if>
      <if test="usedScore != null" >
        used_score = #{usedScore,jdbcType=DECIMAL},
      </if>
      <if test="remainScore != null" >
        remain_score = #{remainScore,jdbcType=DECIMAL},
      </if>
      <if test="activeFlag != null" >
        active_flag = #{activeFlag,jdbcType=CHAR},
      </if>
      <if test="deleteFlag != null" >
        delete_flag = #{deleteFlag,jdbcType=CHAR},
      </if>
      <if test="createdDate != null" >
        created_date = #{createdDate,jdbcType=TIMESTAMP},
      </if>
      <if test="createdBy != null" >
        created_by = #{createdBy,jdbcType=BIGINT},
      </if>
      <if test="lastUpdatedDate != null" >
        last_updated_date = #{lastUpdatedDate,jdbcType=TIMESTAMP},
      </if>
      <if test="lastUpdatedBy != null" >
        last_updated_by = #{lastUpdatedBy,jdbcType=BIGINT},
      </if>
    </set>
    where user_id = #{userId,jdbcType=BIGINT}
  </update>
	

	<!-- 累加会员钱包 -->
	<update id="increaseWalletAmountByUserIdSelective" parameterType="com.wwh.vo.WalletAmountVO" >
    update wallet_amount_t
    <set >
      <if test="userId != null" >
        user_id = #{userId,jdbcType=BIGINT},
      </if>
      <if test="totalScore != null" >
        total_score = total_score + #{totalScore,jdbcType=DECIMAL},
      </if>
      <if test="rechargeAmount != null" >
        recharge_amount =recharge_amount+ #{rechargeAmount,jdbcType=DECIMAL},
      </if>
      <if test="platformTotalAmount != null" >
        platform_total_amount =platform_total_amount+ #{platformTotalAmount,jdbcType=DECIMAL},
      </if>
      <!-- <if test="usedScore != null" >
        used_score = #{usedScore,jdbcType=DECIMAL},
      </if>
      <if test="remainScore != null" >
        remain_score = #{remainScore,jdbcType=DECIMAL},
      </if> -->
      <if test="activeFlag != null" >
        active_flag = #{activeFlag,jdbcType=CHAR},
      </if>
      <if test="deleteFlag != null" >
        delete_flag = #{deleteFlag,jdbcType=CHAR},
      </if>
          <if test="userId != null and userId!='' " >
        last_updated_date =now(),
      </if>
      <if test="lastUpdatedBy != null" >
        last_updated_by = #{lastUpdatedBy,jdbcType=BIGINT},
      </if>
    </set>
    where user_id = #{userId,jdbcType=BIGINT}
  </update>
  
  

</mapper>  